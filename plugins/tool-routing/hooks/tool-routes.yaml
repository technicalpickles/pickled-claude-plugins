# Default tool routes shipped with the plugin.
# Other plugins can contribute routes via their own hooks/tool-routes.yaml.
# Project-specific routes go in .claude/tool-routes.yaml.

routes:
  # Atlassian - use MCP tools
  atlassian:
    tool: WebFetch
    pattern: "https?://[^/]*\\.atlassian\\.net"
    message: |
      Use Atlassian MCP tools for Jira/Confluence.

      Call: mcp__MCPProxy__retrieve_tools
      Query: 'jira confluence atlassian issue'

      MCP tools provide authentication and structured data.
    tests:
      - desc: "Jira URL should block"
        input:
          tool_name: WebFetch
          tool_input:
            url: "https://mycompany.atlassian.net/browse/PROJ-123"
        expect: block
      - desc: "Confluence URL should block"
        input:
          tool_name: WebFetch
          tool_input:
            url: "https://mycompany.atlassian.net/wiki/spaces/DOC/pages/123"
        expect: block

  # Buildkite - use MCP tools
  buildkite:
    tool: WebFetch
    pattern: "https?://buildkite\\.com/[^/]+/[^/]+/builds/\\d+"
    message: |
      Use Buildkite MCP tools for build information.

      Call: mcp__MCPProxy__retrieve_tools
      Query: 'buildkite build status pipeline'

      MCP tools provide authentication and structured build data.
    tests:
      - desc: "build URL should block"
        input:
          tool_name: WebFetch
          tool_input:
            url: "https://buildkite.com/myorg/mypipeline/builds/123"
        expect: block
      - desc: "pipeline URL should allow"
        input:
          tool_name: WebFetch
          tool_input:
            url: "https://buildkite.com/myorg/mypipeline"
        expect: allow

  # cat heredoc - use Write tool instead
  bash-cat-heredoc:
    tool: Bash
    pattern: "cat\\s+.*<<[-]?\\s*['\"]?\\w+['\"]?(?!.*\\|)"
    message: |
      Don't use cat with heredocs for file creation or display.

      For writing to files:
        Use the Write tool instead of cat with redirection.
        Example: Write(file_path="/path/to/file", content="...")

      For displaying text to the user:
        Output text directly in your response.
        Don't use cat or echo - just write the text.

      Valid heredoc use:
        Only use cat <<EOF when piping to another command:
        cat <<EOF | jq .
    tests:
      - desc: "cat heredoc to file should block"
        input:
          tool_name: Bash
          tool_input:
            command: "cat > file.txt << 'EOF'\nHello\nEOF"
        expect: block
      - desc: "cat heredoc with pipe should allow"
        input:
          tool_name: Bash
          tool_input:
            command: "cat <<EOF | jq .\n{\"key\": \"value\"}\nEOF"
        expect: allow

  # chained echo - output directly instead
  bash-echo-chained:
    tool: Bash
    pattern: "echo\\s+[\"'].*&&\\s+echo.*&&\\s+echo"
    message: |
      Don't use chained echo commands for multi-line output.

      For displaying information to the user:
        Output text directly in your response.
        Don't use echo with && chains - just write the text.

      The echo command should only be used for:
        - Single simple outputs in legitimate shell operations
        - Testing or debugging actual shell behavior
    tests:
      - desc: "triple echo chain should block"
        input:
          tool_name: Bash
          tool_input:
            command: "echo \"=== SUMMARY ===\" && echo \"\" && echo \"Done\""
        expect: block
      - desc: "single echo should allow"
        input:
          tool_name: Bash
          tool_input:
            command: "echo 'test'"
        expect: allow

  # echo redirect - use Write tool instead
  bash-echo-redirect:
    tool: Bash
    pattern: "^echo\\s+[\\s\\S]*>\\s*/"
    message: |
      Don't use echo with file redirection to write files.

      Use Write tool instead:
        Write(file_path="/path/to/file", content="...")

      Advantages:
        - Clearer intent and better error handling
        - No shell quoting issues
        - Content is visible in tool call for review
        - Consistent with other file operations

      The echo command should only be used for:
        - Displaying output to stdout in legitimate shell operations
        - Testing or debugging actual shell behavior
    tests:
      - desc: "echo redirect to absolute path should block"
        input:
          tool_name: Bash
          tool_input:
            command: "echo 'content' > /tmp/file.txt"
        expect: block
      - desc: "echo to stdout should allow"
        input:
          tool_name: Bash
          tool_input:
            command: "echo 'hello'"
        expect: allow

  # tool-routing manual test - use proper test infrastructure
  tool-routing-manual-test:
    tool: Bash
    pattern: "(?:echo|printf).*\\|.*tool-routing\\s+(?:check|test)"
    message: |
      Don't manually test tool-routing with piped JSON.

      Use the proper testing infrastructure:
        - `uv run tool-routing test` - Pattern tests
        - `uv run tool-routing integration-test` - Runtime tests

      These commands provide:
        - Version-controlled test fixtures
        - Clear pass/fail reporting
        - Repeatable results
        - No JSON escaping issues

      See: docs/writing-routes.md
    tests:
      - desc: "echo JSON pipe to check should block"
        input:
          tool_name: Bash
          tool_input:
            command: 'echo ''{"tool_name": "Bash"}'' | uv run tool-routing check'
        expect: block
      - desc: "printf JSON pipe to check should block"
        input:
          tool_name: Bash
          tool_input:
            command: 'printf ''%s\n'' "$json" | uv run tool-routing check'
        expect: block
      - desc: "echo pipe to test command should block"
        input:
          tool_name: Bash
          tool_input:
            command: 'echo ''{"test": "data"}'' | uv run tool-routing test'
        expect: block
      - desc: "normal test command should allow"
        input:
          tool_name: Bash
          tool_input:
            command: "uv run tool-routing test"
        expect: allow
      - desc: "normal integration test should allow"
        input:
          tool_name: Bash
          tool_input:
            command: "uv run tool-routing integration-test"
        expect: allow
